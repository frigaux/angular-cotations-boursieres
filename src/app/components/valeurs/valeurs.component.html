<app-loader [affiche]="loading" [configuration]="[
  {marginLeft: '0', marginTop: '1rem', height: '3rem', width: '100%'}
]"></app-loader>

<div class="conteneur" [ngClass]="{'avec-details': valeurSelectionnee !== undefined}">
  @if (!loading && marches) {
    <p-tabs>
      <p-tablist>
        @for (marche of marches; track marche.libelle; let i = $index) {
          <p-tab [value]="i">
            {{ marche.libelle }}
          </p-tab>
        }
      </p-tablist>
      <p-tabpanels>
        @for (marche of marches; track marche.libelle; let i = $index) {
          <p-tabpanel [value]="i">
            <p-table
              sortField="libelle"
              [scrollable]="true" scrollHeight="calc(100vh - 20rem)"
              [style]="{ margin: '1rem' }"
              [tableStyle]="{'table-layout': 'fixed'}"
              [value]="marche.valeurs"
              [loading]="loading">
              <ng-template #header>
                <tr>
                  <th pSortableColumn="libelle">
                    {{ 'COMPOSANTS.VALEURS.LIBELLE' | translate }}
                    <p-sortIcon field="libelle"/>
                    <p-columnFilter type="text" field="libelle" matchMode="contains" display="menu"
                                    [showMatchModes]="false"
                                    [showOperator]="false" [showAddButton]="false"/>
                  </th>
                  <th pSortableColumn="ticker">
                    {{ 'COMPOSANTS.VALEURS.TICKER' | translate }}
                    <p-sortIcon field="ticker"/>
                    <p-columnFilter type="text" field="ticker" matchMode="contains" display="menu"
                                    [showMatchModes]="false"
                                    [showOperator]="false" [showAddButton]="false"/>
                  </th>
                </tr>
              </ng-template>
              <ng-template #body let-valeur>
                <tr (click)="basculerAffichageValeur(valeur)">
                  <td class="libelle">{{ valeur.libelle }}</td>
                  <td>{{ valeur.ticker }}</td>
                </tr>
              </ng-template>
            </p-table>
          </p-tabpanel>
        }
      </p-tabpanels>
    </p-tabs>

    <app-details-valeur [valeur]="valeurSelectionnee" (ferme)="valeurSelectionnee = undefined"></app-details-valeur>
  }
</div>
