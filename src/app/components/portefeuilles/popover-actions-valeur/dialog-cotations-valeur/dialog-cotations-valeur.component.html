<app-dialog-actualite-valeur></app-dialog-actualite-valeur>

<p-dialog [showHeader]="false" [modal]="true" [(visible)]="visible">
  <div class="barre-superieure-sticky">
    <h2>
      {{
        'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.COTATIONS_VALEUR' | translate : {
          valeur: valeur?.libelle,
          ticker: valeur?.ticker
        }
      }}
    </h2>
    <span class="pi pi-refresh" (click)="rafraichir()"
          title="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.RAFRAICHIR' | translate }}"></span>
    <span class="pi pi-times-circle" (click)="fermer()"
          title="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.FERMER' | translate }}"></span>
  </div>

  <app-loader [affiche]="loading" [configuration]="[
        {marginLeft: '0', marginTop: '0', height: '60vh', width: '50rem'}
      ]"></app-loader>

  @if (!loading) {
    @if (cotationsTickerDecore) {
      <p-chart type="line" [data]="cotationsTickerDecore.dto.chartData" [options]="chartOptions"/>
      <div class="ligne">
        <div class="colonne">
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.ORDRES' | translate }}">
            <p-chart type="doughnut" [data]="cotationsTickerDecore.ordresDoughnut" height="14rem" width="20rem"/>
          </p-fieldset>
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.COTATIONS' | translate }}">
            <div class="cotations">
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.COURS' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.cours | currency:'€' }}</span>
              </div>
              <app-jauge
                [cleMinimum]="'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.PLUS_BAS'"
                [cleMaximum]="'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.PLUS_HAUT'"
                [pourcentage]="cotationsTickerDecore.pourcentageCours"></app-jauge>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.VAR_OUVERTURE' | translate }}</label>
                <span
                  [class]="VueUtil.evolutionVariation(cotationsTickerDecore.variationOuverture)">{{ cotationsTickerDecore.variationOuverture  | percent:'1.2-2' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.VAR_CLOTURE_VEILLE' | translate }}</label>
                <span
                  [class]="VueUtil.evolutionVariation(cotationsTickerDecore.variationClotureVeille)">{{ cotationsTickerDecore.variationClotureVeille  | percent:'1.2-2' }}</span>
              </div>
            </div>
          </p-fieldset>
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.INDICATEURS' | translate }}">
            <div class="indicateurs">
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.VOLUME' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.volume | number }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.CAPITAL_ECHANGE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.pourcentageCapitalEchange  | percent:'1.2-2' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.VALORISATION' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.valorisation }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.LIMITE_BAISSE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.limiteBaisse | currency:'€' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.LIMITE_HAUSSE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.limiteHausse | currency:'€' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.RENDEMENT_ESTIME' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.pourcentageRendementEstime | percent:'1.2-2' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.PER_ESTIME' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.perEstime | number }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.DERNIER_DIVIDENDE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.dernierDividende | currency:'€' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.DATE_DERNIER_DIVIDENDE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.dateDernierDividende | date: 'dd/MM/yyyy' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.RISQUE_ESG' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.cotations.risqueESG }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.TONNES_CO2' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.risqueESG.tonnesCO2 | number }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.NIVEAU_CONTROVERSE' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.risqueESG.niveauControverse }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.IMPACT_POSITIF' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.risqueESG.impactPositif }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.IMPACT_NEGATIF' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.risqueESG.impactNegatif }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.CONSENSUS' | translate }}</label>
                <span>{{ `ENUMERATIONS.CONSEIL.${cotationsTickerDecore.dto.consensus.conseil}` | translate }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.OBJECTIF_3MOIS' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.consensus.objectif3mois | currency:'€' }}</span>
              </div>
              <div>
                <label>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.POTENTIEL_3MOIS' | translate }}</label>
                <span>{{ cotationsTickerDecore.dto.consensus.pourcentagePotentiel3mois | percent:'1.2-2' }}</span>
              </div>
            </div>
          </p-fieldset>
        </div>
        <div class="colonne">
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.ACTUALITES' | translate }}">
            <div class="actualites">
              @for (actualite of cotationsTickerDecore.dto.actualites; track actualite.id) {
                <div>
                  <span>{{ actualite.date }}</span>
                  <span (click)="afficherInformation(actualite)">{{ actualite.titre }}</span>
                </div>
              }
            </div>
          </p-fieldset>
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.ANALYSES' | translate }}">
            <div class="analyses">
              @for (analyse of cotationsTickerDecore.dto.analyses; track analyse.id) {
                <div>
                  <span>{{ analyse.date }}</span>
                  <span (click)="afficherInformation(analyse)">{{ analyse.titre }}</span>
                </div>
              }
            </div>
          </p-fieldset>
          <p-fieldset
            legend="{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.PREVISIONS' | translate }}">
            <div class="previsions">
              <p-table size="small"
                       [value]="cotationsTickerDecore.dto.consensus.previsions"
                       [loading]="loading">
                <ng-template #header>
                  <tr>
                    <th>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.ANNEE' | translate }}</th>
                    <th
                      style="text-align: right">{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.DIVIDENDE' | translate }}
                    </th>
                    <th
                      style="text-align: right">{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.RENDEMENT' | translate }}
                    </th>
                    <th
                      style="text-align: right">{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.BENEFICE' | translate }}
                    </th>
                    <th
                      style="text-align: right">{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.PER' | translate }}
                    </th>
                  </tr>
                </ng-template>
                <ng-template #body let-prevision>
                  <tr>
                    <td>{{ prevision.annee }}</td>
                    <td style="text-align: right">{{ prevision.dividende  | currency:'€' }}</td>
                    <td style="text-align: right">{{ prevision.pourcentageRendement | percent:'1.2-2' }}</td>
                    <td style="text-align: right">{{ prevision.benefice  | currency:'€' }}</td>
                    <td style="text-align: right">{{ prevision.per | number }}</td>
                  </tr>
                </ng-template>
              </p-table>
              @if (cotationsTickerDecore.dto.evenements.length > 0) {
                <h3>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.EVENEMENTS' | translate }}</h3>
                @for (evenement of cotationsTickerDecore.dto.evenements; track evenement.id) {
                  <div>
                    <span>{{ evenement.date }}</span>
                    <span (click)="afficherInformation(evenement)">{{ evenement.titre }}</span>
                  </div>
                }
              }
              @if (cotationsTickerDecore.dto.communiques.length > 0) {
                <h3>{{ 'COMPOSANTS.PORTEFEUILLES.ACTIONS_VALEUR.DIALOG_COTATIONS_VALEUR.COMMUNIQUES' | translate }}</h3>
                @for (communique of cotationsTickerDecore.dto.communiques; track communique.id) {
                  <div>
                    <span>{{ communique.date }}</span>
                    <span (click)="afficherInformation(communique)">{{ communique.titre }}</span>
                  </div>
                }
              }
            </div>
          </p-fieldset>
        </div>
      </div>
    }
  }
</p-dialog>
